\section{Introduction} \label{intro}
%In our introduction we want to start from big picture (LIGO, ML, pipelines)
%and narrow down to what work we are presenting here and why it is important. We
%also describe in which ways it is novel and how it compares to previous works
%like in~\cite{Chatterjee:2019avs}. We may also want to cite~\cite{Sachdev:2020lfd}. 

The first detection of a \ac{GW} signal from a pair of coalescing black holes in 2015 and the first observation of a coalescing binary neutron star system two years later have established \ac{MMA} as
a powerful tool for the exploration of the cosmos~\cite{LIGOScientific:2016aoc,LIGOScientific:2017vwq,LIGOScientific:2018cki}. The third \ac{LVK} catalog of transient \ac{GW} signals
\ac{GWTC3}~\cite{LIGOScientific:2021djp} has shown that \ac{GW} astronomy has entered its mature phase, becoming a true observational branch of astronomy. \ac{MMA} allows scientists to explore
in depth the origin and structure of black holes~\cite{Schmidt:2020ekt,Nitz:2021zwj,Barack:2018yly}, neutron stars~\cite{Ruiz:2021gsv,Lasky:2015uia,Baiotti:2016qnr} and gamma-ray bursts~\cite{Ciolfi:2018tal}, test general
relativity~\cite{Berti:2018cxi,Berti:2018vdi,Bhagwat:2021kwv}, probe the fundamental nature of gravity~\cite{LISA:2022yao,Barausse:2020rsu,Piorkowska-Kurpas:2022idw}, and measure the evolution of the
universe~\cite{LIGOScientific:2021sio,LIGOScientific:2021psn,LIGOScientific:2021aug}. \todo{check all the above references, make sure bibliography is complete and up to date}

A wealth of new detections is being amassed to achieve these science goals~\cite{LIGOScientific:2014pky,VIRGO:2014yos}. The rate of detections in \ac{LVK}'s \ac{O4} is close to one per day and
is expected to further increase in the \ac{O5}~\cite{KAGRA:2013rdx}. Over the course of \ac{O4} and the next observing runs, the \ac{LVK} collaboration will analyze hundreds of \ac{BBH} and
dozens of \ac{BNS} and \ac{NSBH} detections, several of which could be \ac{MMA} sources. Among the challenges that this new phase of \ac{GW} astronomy brings is the necessity to coordinate the
activities of \ac{EM} and \ac{GW} observatories in real time. 

One of the most interesting areas of study in \ac{MMA} astronomy is the physics of gravity-matter interaction in \ac{GW} sources. Tidally disrupted matter in an \ac{NSBH} system may form a
high-temperature accretion disk around the \ac{BH} and trigger the creation of a prompt \ac{EM} emission in the form of a short \ac{GRB}. If the system ejecta are unbound, r-process
nucleosynthesis may lead to a \ac{KN}~\cite{Lattimer:1974slx, Li:1998bw, Korobkin:2012uy, Barnes:2013wka, Tanaka:2013ana, Kasen:2014toa}. These phenomena could also arise in \ac{BNS}
post-mergers through the expulsion of neutron-rich material even when tidal forces are weak~\cite{LIGOScientific:2017ync, Arcavi:2017xiz, Coulter:2017wya, Kasliwal:2017ngb, Lipunov:2017dwd,
DES:2017kbs, Tanvir:2017pws}. The presence of a post-merger matter remnant, which results in an \ac{EM} signature or a prompt collapse, is a common factor in all of these scenarios. Determining
the potential of a \ac{GW} source to become an \ac{EM} emitter and enabling coincident observations of these systems by \ac{EM} and \ac{GW} observatories in low latency are crucial for the success
of \ac{MMA}.

The \ac{LVK} employs different matched-filtering pipelines for low-latency \ac{GW} searches~\cite{Sachdev:2020lfd,Nitz:2018rgo,Adams:2015ulm} \todo{add and check references for pipelines and add
spiir}. These searches are based on discrete template banks of \ac{CBC} waveforms that provide, among other parameters, the component masses and the dimensionless (anti-)aligned spins of the
objects along the orbital angular momentum. These parameters can be used to determine the \ac{EM} properties of \ac{GW} candidates in real time through empirical fits of \ac{NR}
simulations~\cite{Foucart:2012nc,Foucart:2018rjc}. Low-latency preliminary alerts of candidate \ac{GW} events in the \ac{O3} included two \ac{EM}-property metrics identifying whether the
\ac{CBC} system contains a \ac{NS}, \hasns, and a post-merger matter remnant, \hasrem. Alerts with similar content continue to be issued in \ac{O4} with a \todo{median?} latency of the order of
one second after the detection of candidate merger events.  Additionally, \ac{LVK}'s \ac{O4} alerts include a measure of the \hasgap\ property, i.e., the likelihood that one of the source
compact objects has a mass in the lower-mass gap region between \ac{NS}s and \ac{BH}s \todo{ref of user guide or other here}.

Classification of \ac{GW} candidate events in low latency poses several challenges as the desire for accuracy contrasts with the desire to issue the information as quickly as possible. The
approach taken by the \ac{LVK} so far has been to use a supervised \ac{KNN}~\cite{Pedregosa:2011ork} \ac{ML} algorithm with input from the detection pipelines and \ac{EOS} models to generate
independent \hasns\ and \hasrem\ binary classification \emph{scores}~\cite{Chatterjee:2019avs}. The \ac{KNN} model is trained on a broad set of synthetic \ac{CBC} signals injected in real
detector noise from the \ac{O2}. The advantage of this scheme relies in the capability of the method to handle the statistical uncertainties of the parameters from the search pipelines and the
non-stationarity of the detectors' power spectral density. This approached allowed for a marked improvement in performance compared to the semi-analytic effective Fisher formalism method that
was deployed in \ac{O2}.

In this work, we revisit the problem of the real-time production of \hasns\ and \hasrem\ \emph{probability} metrics with the aim of further improving the latency and performance of the current
\ac{LVK} \ac{ML}-based scheme~\cite{Chatterjee:2019avs}. In the current implementation, the validity of the classification outcome for an event is assessed through elements of the algorithm's
confusion matrix and its \ac{ROC} curve. For example, given a positive prediction, the \ac{LVK} defines a ``score'' that this prediction is correct as the \ac{TPR} for the given data
set. However, there is no quantity in the algorithm's confusion matrix that defines a probability in the strictest sense. A second limitation of current \hasns\ and \hasrem\ classification
schemas is the fact that the \hasns\ and \hasrem\ labels are treated as independent variables. In reality, the probability of a system being \ac{EM} bright is always smaller than the probability
of the system hosting a \ac{NS}. Therefore, the \hasns\ and \hasrem\ labels cannot be treated as disjoint. In the current \ac{LVK} implementation, this physical condition is data-based rather
than being mathematically defined, i.e., the algorithm potentially allows for violations and the absence of inversions is only checked a posteriori through (coarse) parameter sweeps. One of the
main purposes of this work is to go beyond the above scheme and calculate true \emph{conditional Bayesian probabilities} for \hasns\ and \hasrem. 

To achieve this, we design a new classification scheme and perform a thorough study and comparison of two alternative \ac{ML} algorithms. We first implement a definition for conditional \hasns\
and \hasrem\ metrics that incorporates \emph{ab initio} the physical requirement that a system with a post-merger matter remnant must necessarily contain a \ac{NS}. Then we calculate
\emph{Bayesian probabilities} for \hasns\ and \hasrem. We also implement a marginalization procedure over a set of \ac{EOS} that minimizes possible systematics arising from the use of a single
\ac{EOS}. Finally, test the performance of the scheme and the algorithms on synthetic \ac{O3} signals and confident \ac{GW} detections from the latest \ac{GWTC3} catalog.

The structure of the paper is as follows. Section~\ref{algos} introduces the classification algorithms. Bayesian probabilities for \hasns\ and \hasrem\ and the labeling scheme are defined in
Sec.~\ref{probability}. The data set is described in Sec.~\ref{dataset}. Results and algorithm comparison are reported in Sec.~\ref{results}. Conclusions and future developments are presented in Sec.~\ref{conclusions}.  
