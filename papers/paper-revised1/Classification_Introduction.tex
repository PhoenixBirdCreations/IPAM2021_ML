\section{Introduction} \label{intro}

The first detection of a \ac{GW} signal from a pair of coalescing black holes in 2015 and the first observation of a coalescing binary neutron star system two years later have established
\ac{MMA} as a powerful tool for the exploration of the cosmos~\cite{LIGOScientific:2016aoc,LIGOScientific:2017vwq,LIGOScientific:2018cki}. The third \ac{LVK} catalog of transient \ac{GW}
signals \ac{GWTC3}~\cite{LIGOScientific:2021djp} has shown that \ac{GW} astronomy has entered its mature phase, becoming a true observational branch of astronomy. \ac{MMA} allows
scientists to explore in depth the origin and structure of  \tocheck{\acp{NS}~\cite{Ruiz:2021gsv,Baiotti:2016qnr,Lasky:2015uia},
\acp{GRB}~\cite{Murase:2019tjj,Ciolfi:2018tal}, and \acp{BH} through the observation of their progenitors}~\cite{Schmidt:2020ekt,Nitz:2021zwj,Barack:2018yly}, test general relativity~\cite{LIGOScientific:2021sio,Berti:2018cxi,Berti:2018vdi,Isi:2019aib}, probe the fundamental nature of
gravity~\cite{LISA:2022yao,Barausse:2020rsu,Piorkowska-Kurpas:2022idw}, and measure the evolution of the universe~\cite{LIGOScientific:2021psn,LIGOScientific:2021aug}.

A wealth of new detections is being amassed to achieve these science goals~\cite{LIGOScientific:2014pky,VIRGO:2014yos}. The rate of detections in \ac{LVK}'s \ac{O4} is close to one per
day and is expected to further increase in the \ac{O5}~\cite{KAGRA:2013rdx}. Over the course of \ac{O4} and the next observing runs, \tocheck{the LVK collaborations are expected to analyze hundreds of binary black hole (BBH) candidate detections, as well as dozens of binary neutron star (BNS) and neutron star and black hole (NSBH) merger events that could potentially be MMA sources.} Among the challenges that this new phase of \ac{GW} astronomy brings is the necessity
to coordinate the activities of \ac{EM} and \ac{GW} observatories in real time. 

One of the most interesting areas of study in \ac{MMA} is the physics of gravity-matter interaction in \ac{GW} sources. Tidally disrupted matter in systems with a \ac{NS} may form a
high-temperature accretion disk around the \ac{BH} and trigger the creation of a prompt \ac{EM} emission in the form of a short \ac{GRB}. If the system ejecta are unbound, r-process
nucleosynthesis may lead to a kilonova~\cite{Lattimer:1974slx, Li:1998bw, Korobkin:2012uy, Barnes:2013wka, Tanaka:2013ana, Kasen:2014toa}. These phenomena could also arise in \ac{BNS}
post-mergers through the expulsion of neutron-rich material even when tidal forces are weak~\cite{LIGOScientific:2017ync, Arcavi:2017xiz, Coulter:2017wya, Kasliwal:2017ngb,
Lipunov:2017dwd, DES:2017kbs, Tanvir:2017pws}. The presence of a post-merger matter remnant, which results in an \ac{EM} signature or a prompt collapse, is a common factor in all of these
scenarios. Determining the potential of a \ac{GW} source to become an \ac{EM} emitter and enabling coincident observations of these systems by \ac{EM} and \ac{GW} observatories in low
latency are crucial for the success of \ac{MMA}.

The \ac{LVK} employs different matched-filtering pipelines for low-latency \ac{GW}
searches~\cite{Sachdev:2019vvd,PhysRevD.95.042001,Sachdev:2020lfd,Nitz:2018rgo,Adams:2015ulm,Chu:2020pjv,Klimenko:2015ypf}. These searches are based on discrete template banks of \ac{CBC}
waveforms that provide, among other parameters, the component masses and the dimensionless (anti-)aligned spins of the objects along the orbital angular momentum. These parameters can be
used to determine the \ac{EM} properties of \ac{GW} candidates in real time through empirical fits of \ac{NR} simulations~\cite{Foucart:2012nc,Foucart:2018rjc}. Alerts of candidate
\ac{GW} events that included two \ac{EM}-property metrics identifying whether the \ac{CBC} system contains a \ac{NS}, \hasns, and a post-merger matter remnant, \hasrem, were issued in
\ac{O3} with a median latency of the order of a few minutes after detection. Alerts with similar content continue to be issued in \ac{O4} with even lower latency.  Additionally,
\ac{LVK}'s \ac{O4} alerts include a measure of the \hasgap\ property, i.e., the likelihood that one of the source compact objects has a mass in the lower-mass gap region between \acp{NS}
and \acp{BH}~\cite{Farah:2021qom} (see the \ac{LVK} online user guide~\cite{UserGuide}). 

Classification of \ac{GW} candidate events in low latency poses several challenges as the need for accuracy contrasts with the urgency to issue the information as quickly as possible. The
approach taken by the \ac{LVK} so far has been to use a specific implementation of a supervised \ac{KNN} \ac{ML}
algorithm~\cite{Pedregosa:2011ork} with input from the detection pipelines and \ac{EOS} models to generate independent \hasns\ and \hasrem\ \tocheck{\emph{binary} classification
probabilities}~\cite{Chatterjee:2019avs}. The \ac{KNN} model is trained on a broad set of synthetic \ac{CBC} signals injected in real detector noise from the \ac{O2}. The advantage of this
scheme relies on its capability to handle the statistical systematic uncertainties in the parameters recovered by the search pipelines. This approach allowed for a marked improvement in
speed compared to the semi-analytic effective Fisher formalism method that was deployed in \ac{O2}.

In this work, we revisit the problem of the real-time production of \hasns\ and \hasrem\ probability metrics with the aim of further improving the latency and performance of the
current \ac{LVK} \ac{ML}-based scheme~\cite{Chatterjee:2019avs}. \tocheck{In the current \ac{LVK} implementation, the validity of an event's classification outcome is evaluated using elements from the algorithm's confusion matrix and its \ac{ROC} curve, which is typically used to evaluate the performance of an algorithm by plotting the \ac{TPR} against the \ac{FPR} at various threshold values. \emph{Algorithmic} probabilities for \hasns\ and \hasrem\ are the fractions of \ac{KNN} neighbors around an event that, according to the algorithm's training, indicate whether the event  has an \ac{NS} or is \ac{EM}-bright. In this work, we adopt a new strategy, constructing \emph{Bayesian} probabilities from a complementary data set to the training data set.} A second limitation of the current  classification implementation is the fact that the \hasns\ and \hasrem\ labels are treated as independent variables. In reality, the probability of the formation of
tidally disrupted matter, i.e. an \ac{EM} bright event, is always smaller than the probability of the system hosting a \ac{NS}. Therefore, the \hasns\ and \hasrem\ labels cannot be
treated as disjoint. \tocheck{Currently, this physical requirement is not implemented mathematically but rather is based on data; the lack of inversions is tested a posteriori using a technique known as \emph{parameter sweep}, which involves assessing the algorithm's performance across the whole parameter space. One of the main purposes of this work is to go beyond the above scheme and
calculate true \emph{conditional} probabilities for \hasns\ and \hasrem.} 

To achieve this, we design a new classification scheme and perform a thorough study and comparison of two \ac{ML} algorithms. We first implement a definition for conditional \hasns\ and
\hasrem\ metrics that incorporates \emph{ab initio} the physical requirement that a system with a post-merger matter remnant must necessarily contain a \ac{NS}. Then we calculate
\tocheck{Bayesian probabilities} for \hasns\ and \hasrem. We also implement a marginalization procedure over a set of \ac{EOS} that minimizes possible systematics arising from the use of a
single \ac{EOS}. Finally, we test the performance of the scheme and the algorithms on synthetic \ac{O3} signals and confident \ac{GW} detections from the latest \ac{GWTC3} catalog.

The structure of the paper is as follows. Section~\ref{algos} introduces the classification algorithms. Bayesian probabilities for \hasns\ and \hasrem\ and the labeling scheme are defined
in Sec.~\ref{probability}. The data set is described in Sec.~\ref{dataset}. Results and algorithm comparisons are reported in Sec.~\ref{results}. Conclusions and future developments are
presented in Sec.~\ref{conclusions}.  \tocheck{The process of cross-validation of our algorithms is covered in depth in Appendix~\ref{app:crossval}. A direct comparison of our approach with the current LVK method is provided in Appendix~\ref{app:comparison}.}
